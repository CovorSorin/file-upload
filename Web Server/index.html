<!DOCTYPE html>
<html>
    <title>File Sort</title>
    <script>
    // read using the FILE API
    function loadFile() {
        var input, file, fr;

        input = document.getElementById('fileinput');

        if (typeof window.FileReader !== 'function') {
            bodyAppend("p", "The file API isn't supported on this browser yet.");
            return;
        }

        if (!input) {
            bodyAppend("p", "Couldn't find the fileinput element.");
        }
        else if (!input.files) {
            bodyAppend("p", "This browser doesn't seem to support the `files` property of file inputs.");
        }
        else if (!input.files[0]) {
            bodyAppend("p", "Please select a file before clicking 'Load'");
        }
        else {
            file = input.files[0];
            fr = new FileReader();
            fr.onload = receivedText;
            fr.readAsText(file);
        }

        function receivedText() {
            showResult(fr, "Text");
            fr = new FileReader();
            fr.readAsBinaryString(file);
        }
    }

    function showResult(fr, label) {
        var markup, result, n, aByte, byteStr, text;
        text = [];
        markup = [];
        result = fr.result;
        for (n = 0; n < result.length; ++n) {
            aByte = result.charCodeAt(n);
            byteStr = aByte.toString(16);
            if (byteStr.length < 2) {
                byteStr = "0" + byteStr;
            }
            markup.push(byteStr);
            if(byteStr != '0a' && byteStr != '0d'){
                text.push(hex2asc(byteStr));
            }
        }

        for (var i = 0; i <= text.length; i++){
            document.getElementById("input_text").innerHTML = text[i];
            if (i == text.length)
                document.getElementById("input_text").innerHTML = "eof";
            Send();
        }
        document.getElementById("input_text").innerHTML = text;
    }

    function bodyAppend(tagName, innerHTML) {
        var element;
        element = document.createElement(tagName);
        element.innerHTML = innerHTML;
        document.body.appendChild(element);
    }

    function hex2asc(text) {
        var hex = text.toString();
        var str = '';
        for (var i = 0; i < hex.length; i += 2)
            str += String.fromCharCode(parseInt(hex.substr(i, 2), 16));
        return str;
    }

    var xmlhttp;

    function loadJSONDoc(url, cfunc) {
        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = cfunc;
        xmlhttp.open("POST", url, true);
        xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xmlhttp.send("input_text=" + document.getElementById("input_text").innerText);
    }

    function Send() {
        loadJSONDoc("send", function () {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                document.getElementById("div3").innerText = xmlhttp.responseText;
            }
        });
    }

    function loadTxtDoc(url, cfunc) {
          if (window.XMLHttpRequest) {
          // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
          } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
          }

          xmlhttp.onreadystatechange = cfunc;
          xmlhttp.open("POST", url, true);
          xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    }
    </script>
</head>

<body>
    <div id="div1">
        <h2>Choose a file:</h2>
        <form>
            Select a file: <input type="file" id="fileinput">
            <button type="button" onclick="loadFile()">Send</button>
        </form>
    </div>

    <div id="div2">
            <div id="input_text"></div>
    </div>

    <div id="div3"> Your sorted text will be placed here. </div>
</body>
</html>
